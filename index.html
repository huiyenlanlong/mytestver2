<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IDONOTHINGALLDAYS</title>
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
        import { 
            getFirestore, doc, getDoc, setDoc, updateDoc, collection, getDocs 
        } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";

        // --- Firebase Config (replace with your own values) ---
        const firebaseConfig = {
            apiKey: "AIzaSyA2wn2eE1cYlWXNNEVHJYga_3CbJm-JfnM",
            authDomain: "passwordprotected.firebaseapp.com",
            projectId: "passwordprotected",
            storageBucket: "passwordprotected.firebasestorage.app",
            messagingSenderId: "261596781861",
            appId: "1:261596781861:web:4af0a2ea4e0b07e54b8ecc"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        const ADMIN_PASSWORD = "admin@0385";
        const videos = [
            { id: "1jbytLPLR7vujtFcICnZjtzgoY-SjbwKl", title: "Kesari Chapter 2" },
            { id: "1BLms4P3ZU3cDWgHo95flbrk8R2F8QeHf", title: "Stolen" }
        ];

        // Generate or fetch persistent device ID
        const deviceId = localStorage.getItem("deviceId") || crypto.randomUUID();
        localStorage.setItem("deviceId", deviceId);

        // --- User Login with Device Lock ---
        window.checkPassword = async function () {
            const input = document.getElementById('password').value.trim();
            if (!input) return alert("Enter password!");

            const docRef = doc(db, "passwords", input);
            const docSnap = await getDoc(docRef);

            if (docSnap.exists()) {
                const data = docSnap.data();
                if (data.deactivated) {
                    alert("This password is deactivated!");
                    return;
                }

                // First-time use
                if (!data.used) {
                    await updateDoc(docRef, { 
                        used: true, 
                        deviceId: deviceId, 
                        usedAt: new Date().toISOString() 
                    });
                    loadVideos();
                } 
                // Same device reuse
                else if (data.deviceId === deviceId) {
                    loadVideos();
                } 
                // Other device block
                else {
                    alert("This password is already used on another device!");
                }
            } else {
                alert("Invalid password!");
            }
        };

        window.logout = function () {
            document.getElementById('videoList').innerHTML = "";
            document.getElementById('adminPanel').style.display = "none";
        };

        window.adminLogin = function () {
            const pass = prompt("Enter Admin Password:");
            if (pass === ADMIN_PASSWORD) {
                document.getElementById('adminPanel').style.display = "block";
                loadPasswordList();
                populateVideoSelect();
            } else alert("Incorrect admin password!");
        };

        window.addPassword = async function () {
            const pass = document.getElementById('addPassword').value.trim();
            if (!pass) return alert("Enter password to add!");
            const docRef = doc(db, "passwords", pass);
            const docSnap = await getDoc(docRef);
            if (docSnap.exists()) return alert("Password already exists!");
            await setDoc(docRef, { 
                used: false, 
                deactivated: false, 
                deviceId: null, 
                usedAt: null 
            });
            alert("Password added successfully!");
            document.getElementById('addPassword').value = "";
            loadPasswordList();
        };

        window.deactivatePassword = async function () {
            const pass = document.getElementById('deletePassword').value.trim();
            if (!pass) return alert("Enter password to deactivate!");
            const docRef = doc(db, "passwords", pass);
            const docSnap = await getDoc(docRef);
            if (!docSnap.exists()) return alert("Password not found!");
            await updateDoc(docRef, { deactivated: true });
            alert("Password deactivated!");
            document.getElementById('deletePassword').value = "";
            loadPasswordList();
        };

        async function loadPasswordList() {
            const list = document.getElementById('passwordList');
            list.innerHTML = "";
            const snapshot = await getDocs(collection(db, "passwords"));
            snapshot.forEach(docSnap => {
                const data = docSnap.data();
                list.innerHTML += `<li>${docSnap.id} ${data.deactivated ? '(deactivated)' : data.used ? `(used on ${data.usedAt}, device: ${data.deviceId})` : ''}</li>`;
            });
        }

        window.updateVideoTitle = function () {
            const index = document.getElementById('videoSelect').value;
            const newTitle = document.getElementById('videoTitleInput').value.trim();
            if (newTitle) {
                videos[index].title = newTitle;
                loadVideos();
                populateVideoSelect();
                document.getElementById('videoTitleInput').value = "";
            }
        };

        function populateVideoSelect() {
            const select = document.getElementById('videoSelect');
            select.innerHTML = "";
            videos.forEach((video, index) => {
                const option = document.createElement('option');
                option.value = index;
                option.textContent = video.title;
                select.appendChild(option);
            });
        }

        function loadVideos() {
            const container = document.getElementById('videoList');
            container.innerHTML = "";
            videos.forEach(video => {
                const block = document.createElement('div');
                block.className = 'video-block';
                block.innerHTML = `
                    <div class="video-container">
                        <iframe src="https://drive.google.com/file/d/${video.id}/preview?rm=minimal" allowfullscreen allow="autoplay"></iframe>
                        <div class="iframe-overlay"></div>
                    </div>
                    <div class="video-title">${video.title}</div>`;
                container.appendChild(block);
            });
        }
    </script>
    <style>
        body {font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; margin: 0; background: linear-gradient(120deg, #2c3e50, #3498db); color: #fff;}
        header {background: rgba(0,0,0,0.6); padding: 15px 20px; display: flex; justify-content: center; align-items: center; flex-direction: column; box-shadow: 0 2px 4px rgba(0,0,0,0.3); text-align: center;}
        header h1 {font-size: 8vw; font-weight: bold; text-shadow: 2px 2px 4px rgba(0,0,0,0.7); margin: 0; color: #f1c40f;}
        header h2 {font-size: 4vw; margin: 5px 0 0 0; color: #f1f1f1; font-weight: normal;}
        #userControls {margin-top: 15px; display: flex; flex-wrap: wrap; gap: 10px; width: 100%; max-width: 400px;}
        #userControls input, #userControls button {flex: 1 1 45%; padding: 10px; font-size: 16px; border: none; border-radius: 4px;}
        button {background: #f1c40f; color: #000; font-weight: bold; cursor: pointer;}
        button:hover {background: #d4ac0d;}
        main {display: flex; flex-direction: column; padding: 10px; gap: 20px;}
        .sidebar {width: 100%; background: rgba(255, 255, 255, 0.1); padding: 15px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.3); height: fit-content;}
        .content {flex: 1;}
        .video-grid {display: grid; grid-template-columns: repeat(auto-fill,minmax(250px,1fr)); gap: 20px;}
        .video-block {background: rgba(255,255,255,0.15); border-radius: 8px; padding: 10px; box-shadow: 0 2px 6px rgba(0,0,0,0.3); transition: transform 0.3s; text-align: center; position: relative;}
        .video-block:hover {transform: scale(1.05);}
        .video-title {font-size: 16px; font-weight: bold; margin-top: 10px; color: #f1f1f1;}
        .video-container {position: relative; padding-bottom: 56.25%; height: 0; overflow: hidden; border-radius: 8px;}
        .video-container iframe {position: absolute; top: 0; left: 0; width: 100%; height: 100%; border: 0;}
        .iframe-overlay {position: absolute; top: 0; right: 0; width: 60px; height: 40px; z-index: 2;}
        #adminPanel {display: none;}
        @media(min-width:768px){ main {flex-direction: row;} .sidebar {width: 250px;} }
    </style>
</head>
<body>
<header>
    <h1>IDONOTHINGALLDAYS</h1>
    <h2>by PotatoPork</h2>
    <div id="userControls">
        <input type="password" id="password" placeholder="Enter One-Time Password">
        <button onclick="checkPassword()">Login</button>
        <button onclick="logout()">Logout</button>
        <button onclick="adminLogin()">Admin Login</button>
    </div>
</header>
<main>
    <aside class="sidebar" id="adminPanel">
        <h2>Admin Panel</h2>
        <ul id="passwordList"></ul>
        <input type="text" id="addPassword" placeholder="New Password">
        <button onclick="addPassword()">Add Password</button>
        <input type="text" id="deletePassword" placeholder="Password to Deactivate">
        <button onclick="deactivatePassword()">Deactivate Password</button>
        <select id="videoSelect"></select>
        <input type="text" id="videoTitleInput" placeholder="Edit selected video title">
        <button onclick="updateVideoTitle()">Update Title</button>
    </aside>
    <section class="content">
        <div class="video-grid" id="videoList"></div>
    </section>
</main>
</body>
</html>
